<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Para ti</title>
  <style>
    :root{
      color-scheme: light;
      --bg:#fff4e5;
      --card:#ffffff;
      --text:#0b0b0b;
      --muted:#3a3a3a;
      --border:#e8e3dc;

      --btn:#0b0b0b;
      --btnText:#ffffff;

      --kraftTop:#f1e2d1;
      --kraftBot:#ead7c2;
      --kraftEdge:rgba(40,20,10,.18);

      --waxTop:#8b1a1a;
      --waxBot:#5f0f0f;

      --shadow:rgba(0,0,0,.16);
    }

    body.noche{
      color-scheme: dark;
      --bg:#1b140f;
      --card:#201812;
      --text:#f2eadf;
      --muted:#c9bfb4;
      --border:#352a21;

      --btn:#f2eadf;
      --btnText:#1b140f;

      --kraftTop:#3a2b1f;
      --kraftBot:#2d2118;
      --kraftEdge:rgba(255,240,220,.14);

      --waxTop:#7c1a1a;
      --waxBot:#3a0f0f;

      --shadow:rgba(0,0,0,.35);
    }

    body{
      margin:0;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      background:var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    .wrap{
      max-width:760px;
      margin:0 auto;
      padding:22px 18px 34px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px 16px;
      box-shadow:0 10px 30px rgba(0,0,0,.08);
    }

    h1{
      margin:0 0 6px;
      font-size:22px;
      font-weight:700;
      letter-spacing:.2px;
    }

    .sub{
      margin:0 0 14px;
      font-size:14px;
      color:var(--muted);
      line-height:1.35;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .row-left{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      border:1px solid rgba(0,0,0,.12);
      background:var(--card);
      color:var(--text);
      border-radius:12px;
      padding:10px 14px;
      font-size:14px;
      cursor:pointer;
      transition:transform .12s ease, opacity .12s ease, background .12s ease, color .12s ease, border-color .12s ease;
    }
    body.noche button{ border-color:rgba(255,255,255,.16); }
    button:active{ transform:scale(.99); }

    .primary{
      background:var(--btn);
      color:var(--btnText);
      border-color:var(--btn);
    }
    body.noche .primary{ border-color:var(--btn); }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--border);
      background:var(--card);
      border-radius:999px;
      padding:8px 10px;
      font-size:13px;
      color:var(--muted);
      user-select:none;
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background:#0b0b0b;
      opacity:.18;
    }
    body.noche .dot{ background:#f2eadf; opacity:.16; }

    .switch{
      width:34px;
      height:20px;
      border-radius:999px;
      background:rgba(0,0,0,.12);
      position:relative;
      border:1px solid var(--border);
    }
    body.noche .switch{ background:rgba(255,255,255,.12); }
    .knob{
      position:absolute;
      top:2px;
      left:2px;
      width:16px;
      height:16px;
      border-radius:999px;
      background:var(--card);
      border:1px solid rgba(0,0,0,.08);
      transition:left .18s ease;
    }
    body.noche .knob{ border-color:rgba(255,255,255,.10); }
    .on .knob{ left:16px; }

    .section{
      margin-top:14px;
      padding-top:14px;
      border-top:1px solid var(--border);
    }

    .hide{ display:none; }

    /* Escena del sobre */
    .env-zone{
      display:flex;
      justify-content:center;
      margin-top:14px;
      padding:10px 0 2px;
    }

    .envelope{
      position:relative;
      width:min(390px, 92vw);
      height:250px;
      border-radius:18px;
      perspective:1200px;
      transform:translateZ(0);
    }

    .env-shadow{
      position:absolute;
      inset:0;
      border-radius:18px;
      box-shadow:0 22px 56px var(--shadow);
      opacity:.92;
      pointer-events:none;
      transform:translateY(0) scale(1);
      transition:opacity .2s ease;
    }

    .env-body{
      position:absolute;
      inset:0;
      border-radius:18px;
      overflow:hidden;
      border:1px solid var(--kraftEdge);
      background:
        radial-gradient(circle at 15% 20%, rgba(255,255,255,.18), transparent 42%),
        radial-gradient(circle at 80% 30%, rgba(255,255,255,.12), transparent 45%),
        radial-gradient(circle at 60% 85%, rgba(0,0,0,.08), transparent 48%),
        repeating-linear-gradient(0deg, rgba(0,0,0,.018), rgba(0,0,0,.018) 1px, transparent 1px, transparent 6px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.012), rgba(0,0,0,.012) 1px, transparent 1px, transparent 7px),
        linear-gradient(180deg, var(--kraftTop), var(--kraftBot));
      transform-style:preserve-3d;
    }

    .env-inner-shadow{
      position:absolute;
      inset:0;
      border-radius:18px;
      box-shadow: inset 0 12px 26px rgba(0,0,0,.14);
      pointer-events:none;
      z-index:1;
    }

    .env-fold-left, .env-fold-right{
      position:absolute;
      top:0;
      bottom:0;
      width:56%;
      z-index:2;
      opacity:.95;
      pointer-events:none;
    }
    .env-fold-left{
      left:-10%;
      transform:skewX(-10deg);
      background:linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,.04));
      clip-path:polygon(0 18%, 100% 50%, 0 82%);
    }
    .env-fold-right{
      right:-10%;
      transform:skewX(10deg);
      background:linear-gradient(180deg, rgba(0,0,0,.07), rgba(255,255,255,.03));
      clip-path:polygon(100% 18%, 0 50%, 100% 82%);
    }

    .env-front{
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      height:62%;
      z-index:5;
      border-top:1px solid rgba(40,20,10,.14);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.03));
      pointer-events:none;
    }
    .env-front::before{
      content:"";
      position:absolute;
      left:50%;
      bottom:-2px;
      width:0;
      height:0;
      border-left:225px solid transparent;
      border-right:225px solid transparent;
      border-top:132px solid rgba(0,0,0,.05);
      transform:translateX(-50%);
      filter:drop-shadow(0 1px 0 rgba(0,0,0,.14));
      opacity:.9;
    }

    .env-flap{
      position:absolute;
      left:0;
      right:0;
      top:0;
      height:58%;
      z-index:7;
      transform-origin:top center;
      transform:rotateX(0deg);
      transform-style:preserve-3d;
      pointer-events:none;
    }
    .env-flap::before{
      content:"";
      position:absolute;
      left:50%;
      top:-2px;
      width:0;
      height:0;
      border-left:225px solid transparent;
      border-right:225px solid transparent;
      border-bottom:146px solid rgba(0,0,0,.08);
      transform:translateX(-50%);
      filter:drop-shadow(0 1px 0 rgba(0,0,0,.18));
      opacity:.98;
    }
    .env-flap::after{
      content:"";
      position:absolute;
      left:50%;
      top:-2px;
      width:0;
      height:0;
      border-left:225px solid transparent;
      border-right:225px solid transparent;
      border-bottom:146px solid rgba(255,255,255,.10);
      transform:translateX(-50%) translateY(1px);
      opacity:.9;
      pointer-events:none;
    }

    .paper{
      position:absolute;
      left:50%;
      bottom:18px;
      width:86%;
      height:210px;
      transform:translateX(-50%) translateY(112px);
      background:
        linear-gradient(180deg, rgba(0,0,0,.02), transparent 32%),
        #ffffff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:14px;
      z-index:4;
      box-shadow:0 18px 38px rgba(0,0,0,.18);
      pointer-events:none;
      overflow:hidden;
    }
    .paper::before{
      content:"";
      position:absolute;
      left:14px;
      right:14px;
      top:12px;
      height:10px;
      border-radius:10px;
      background:linear-gradient(90deg, rgba(0,0,0,.06), rgba(0,0,0,0));
      opacity:.55;
    }
    .paper::after{
      content:"";
      position:absolute;
      left:0;
      right:0;
      top:0;
      height:22px;
      background:linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,0));
      opacity:.35;
    }

    .wax{
      position:absolute;
      left:50%;
      bottom:58px;
      transform:translateX(-50%);
      z-index:9;
      width:56px;
      height:56px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 28%, rgba(255,255,255,.22), transparent 40%),
        radial-gradient(circle at 70% 78%, rgba(0,0,0,.18), transparent 46%),
        linear-gradient(180deg, var(--waxTop), var(--waxBot));
      border:1px solid rgba(0,0,0,.25);
      box-shadow:0 12px 26px rgba(0,0,0,.22);
      pointer-events:none;
    }
    .wax::after{
      content:"";
      width:38px;
      height:38px;
      border-radius:999px;
      border:1px dashed rgba(255,255,255,.18);
      opacity:.92;
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
    }

    /* Progreso apertura */
    .open-progress{
      width:min(390px, 92vw);
      margin:10px auto 0;
      height:8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.06);
      overflow:hidden;
    }
    body.noche .open-progress{ background:rgba(255,255,255,.08); }
    .open-bar{
      height:100%;
      width:0%;
      background:var(--btn);
      border-radius:999px;
    }

    /* Apertura realista */
    .envelope.opening{
      animation: envMove 1800ms cubic-bezier(.14,.92,.14,1) forwards;
    }
    .envelope.opening .env-shadow{
      animation: shadowMove 1800ms cubic-bezier(.14,.92,.14,1) forwards;
    }
    .envelope.opening .wax{
      animation: waxBreak 340ms ease forwards;
      animation-delay: 120ms;
    }
    .envelope.opening .env-flap{
      animation: flapOpen 980ms cubic-bezier(.10,.96,.14,1) forwards;
      animation-delay: 200ms;
    }
    .envelope.opening .paper{
      animation: paperPull 1800ms cubic-bezier(.12,.92,.18,1) forwards;
      animation-delay: 520ms;
    }
    .envelope.opening + .open-progress .open-bar{
      animation: openBar 1800ms linear forwards;
    }

    @keyframes envMove{
      0%{ transform:translateY(0) rotate(0deg); }
      14%{ transform:translateY(-8px) rotate(-.8deg); }
      40%{ transform:translateY(-4px) rotate(-.35deg); }
      72%{ transform:translateY(-6px) rotate(-.45deg); }
      100%{ transform:translateY(-5px) rotate(-.42deg); }
    }

    @keyframes shadowMove{
      0%{ opacity:.92; transform:translateY(0) scale(1); }
      25%{ opacity:1; transform:translateY(2px) scale(1.02); }
      60%{ opacity:.96; transform:translateY(1px) scale(1.01); }
      100%{ opacity:.94; transform:translateY(0) scale(1.01); }
    }

    @keyframes waxBreak{
      0%{ opacity:1; transform:translateX(-50%) scale(1) rotate(0deg); }
      45%{ opacity:.85; transform:translateX(-50%) scale(.95) rotate(-7deg); }
      100%{ opacity:0; transform:translateX(-50%) scale(.82) rotate(-14deg); }
    }

    @keyframes flapOpen{
      0%{ transform:rotateX(0deg); }
      55%{ transform:rotateX(168deg); }
      72%{ transform:rotateX(186deg); }
      100%{ transform:rotateX(180deg); }
    }

    @keyframes paperPull{
      0%{ transform:translateX(-50%) translateY(112px) rotate(0deg); }
      38%{ transform:translateX(-50%) translateY(-18px) rotate(-.8deg); }
      62%{ transform:translateX(-50%) translateY(-122px) rotate(-.6deg); }
      78%{ transform:translateX(-50%) translateY(-154px) rotate(-.35deg); }
      100%{ transform:translateX(-50%) translateY(-150px) rotate(-.4deg); }
    }

    @keyframes openBar{
      from{ width:0%; }
      to{ width:100%; }
    }

    /* Vista carta */
    .read-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }

    .read-progress{
      height:8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.06);
      overflow:hidden;
      flex:1;
    }
    body.noche .read-progress{ background:rgba(255,255,255,.08); }
    .read-bar{
      height:100%;
      width:0%;
      background:var(--btn);
      border-radius:999px;
    }

    .read-label{
      font-size:12px;
      color:var(--muted);
      min-width:86px;
      text-align:right;
    }

    .letter{
      font-size:16px;
      line-height:1.6;
      white-space:pre-wrap;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px 14px;
      box-shadow:0 10px 26px rgba(0,0,0,.06);
      max-height:62vh;
      overflow:auto;
    }

    .sig{
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
      padding-left:2px;
    }

    .final{
      margin-top:14px;
      display:flex;
      justify-content:flex-end;
    }

    .final button{
      opacity:.55;
      pointer-events:none;
    }
    .final button.ready{
      opacity:1;
      pointer-events:auto;
    }

    .fade-in{
      animation: fadeIn .28s ease forwards;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(10px); }
      to{ opacity:1; transform:translateY(0); }
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:14px;
      transform:translateX(-50%);
      background:var(--btn);
      color:var(--btnText);
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
      max-width:92vw;
      text-align:center;
    }
    .toast.show{ opacity:1; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <div>
          <h1>Para ti</h1>
          <p class="sub">Ábrelo cuando estés tranquila. No es para leer rápido.</p>
        </div>

        <div class="row-left">
          <button id="nightBtn" class="pill" type="button" aria-pressed="false" title="Modo noche">
            <span class="dot"></span>
            <span>Modo noche</span>
            <span class="switch" id="nightSwitch"><span class="knob"></span></span>
          </button>

          <button id="soundBtn" class="pill" type="button" aria-pressed="true" title="Sonido">
            <span class="dot"></span>
            <span>Sonido</span>
            <span class="switch on" id="soundSwitch"><span class="knob"></span></span>
          </button>
        </div>
      </div>

      <div class="section" id="stage">
        <div class="row-left">
          <button class="primary" id="openBtn" type="button">Abrir</button>
        </div>

        <div class="env-zone" aria-hidden="true">
          <div class="envelope" id="envelope">
            <div class="env-shadow"></div>
            <div class="env-body">
              <div class="env-inner-shadow"></div>
              <div class="env-fold-left"></div>
              <div class="env-fold-right"></div>

              <div class="paper" id="paper"></div>

              <div class="env-front"></div>
              <div class="env-flap"></div>
              <div class="wax"></div>
            </div>
          </div>
        </div>

        <div class="open-progress" aria-hidden="true">
          <div class="open-bar" id="openBar"></div>
        </div>
      </div>

      <div class="section hide" id="letterSection">
        <div class="read-top">
          <div class="read-progress" aria-hidden="true"><div class="read-bar" id="readBar"></div></div>
          <div class="read-label" id="readLabel">Leído 0%</div>
        </div>

        <div class="letter" id="text"></div>
        <div class="sig" id="sig"></div>

        <div class="final">
          <button class="primary" id="closeBtn" type="button">Cerrar y guardar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const TU_NOMBRE = "Alitas De Carne";

    const carta = `Hoy, en esta Navidad, solo quiero decirte algo simple y verdadero.
Gracias por estar en mi vida. Por lo que compartimos desde hace años, por tu forma de ser y por lo que ahora estamos construyendo. Tenerte es un regalo.
Ahora solo estamos empezando pero, te amo porque contigo entendí que amar no es fácil, pero sí vale la pena. El amor real no es perfecto, es constante. Es elegir. Es quedarse. Es trabajar incluso cuando cuesta.
Siempre te lo diré, quiero que recuerdes que yo me desvivo por ti, me arrancaría el corazón por ti, lo voy a dar todo, me voy a esforzar lo que más pueda, porque el que no ama de esta manera es un marica más como tú dices.
Estar junto a ti me hace la persona más feliz del mundo, porque contigo todo se siente más claro, más tranquilo y más verdadero. A tu lado encuentro paz, alegría y un sentido que no necesito explicar. Solo sé que cuando estás tú, todo vale la pena.

No te prometo perfección. Te prometo presencia, respeto, lealtad y amor honesto. Caminar a tu lado, cuidarte y dejarme cuidar.

Te quiero con todo lo que soy.
Con lo que digo y con lo que callo.
Siempre lo he hecho, siempre lo haré.
Este sentimiento es solo tuyo.
Con todo mi corazón, siempre tuyo.`;

    const $ = (id) => document.getElementById(id);

    const openBtn = $("openBtn");
    const envelope = $("envelope");
    const paper = $("paper");
    const stage = $("stage");
    const letterSection = $("letterSection");
    const text = $("text");
    const sig = $("sig");

    const readBar = $("readBar");
    const readLabel = $("readLabel");
    const closeBtn = $("closeBtn");

    const nightBtn = $("nightBtn");
    const nightSwitch = $("nightSwitch");

    const soundBtn = $("soundBtn");
    const soundSwitch = $("soundSwitch");

    const toast = $("toast");

    let sonido = true;
    let noche = false;

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1200);
    }

    function setSwitch(el, on){
      if(on) el.classList.add("on");
      else el.classList.remove("on");
    }

    function applyPrefs(){
      document.body.classList.toggle("noche", noche);
      setSwitch(nightSwitch, noche);
      setSwitch(soundSwitch, sonido);
      nightBtn.setAttribute("aria-pressed", String(noche));
      soundBtn.setAttribute("aria-pressed", String(sonido));
      try{
        localStorage.setItem("pref_noche", noche ? "1" : "0");
        localStorage.setItem("pref_sonido", sonido ? "1" : "0");
      } catch {}
    }

    function loadPrefs(){
      try{
        noche = localStorage.getItem("pref_noche") === "1";
        const s = localStorage.getItem("pref_sonido");
        sonido = s === null ? true : (s === "1");
      } catch {}
      applyPrefs();
    }

    /* Sonido sutil: ruido breve + filtro */
    let audioCtx = null;

    function ensureAudio(){
      if(audioCtx) return;
      const AC = window.AudioContext || window.webkitAudioContext;
      if(!AC) return;
      audioCtx = new AC();
    }

    function playRustle(){
      if(!sonido) return;
      ensureAudio();
      if(!audioCtx) return;

      if(audioCtx.state === "suspended"){
        audioCtx.resume().catch(() => {});
      }

      const t0 = audioCtx.currentTime;

      const dur = 0.22;
      const bufferSize = Math.floor(audioCtx.sampleRate * dur);
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);

      for(let i=0;i<bufferSize;i++){
        data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
      }

      const src = audioCtx.createBufferSource();
      src.buffer = buffer;

      const hp = audioCtx.createBiquadFilter();
      hp.type = "highpass";
      hp.frequency.value = 700;

      const bp = audioCtx.createBiquadFilter();
      bp.type = "bandpass";
      bp.frequency.value = 1800;
      bp.Q.value = 0.8;

      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.0001, t0);
      gain.gain.exponentialRampToValueAtTime(0.12, t0 + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

      src.connect(hp);
      hp.connect(bp);
      bp.connect(gain);
      gain.connect(audioCtx.destination);

      src.start(t0);
      src.stop(t0 + dur);
    }

    function playSealSnap(){
      if(!sonido) return;
      ensureAudio();
      if(!audioCtx) return;

      if(audioCtx.state === "suspended"){
        audioCtx.resume().catch(() => {});
      }

      const t0 = audioCtx.currentTime;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "triangle";
      osc.frequency.setValueAtTime(240, t0);
      osc.frequency.exponentialRampToValueAtTime(90, t0 + 0.08);

      gain.gain.setValueAtTime(0.0001, t0);
      gain.gain.exponentialRampToValueAtTime(0.08, t0 + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.10);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(t0);
      osc.stop(t0 + 0.11);
    }

    function openLetter(){
      text.textContent = carta;

      const fecha = new Date();
      const f = fecha.toLocaleDateString("es-ES", { year:"numeric", month:"long", day:"numeric" });
      sig.textContent = TU_NOMBRE + " · " + f;

      stage.classList.add("hide");
      letterSection.classList.remove("hide");
      letterSection.classList.add("fade-in");
      window.scrollTo({ top: 0, behavior: "smooth" });

      updateReadProgress();
      closeBtn.classList.remove("ready");
    }

    function resetAll(){
      letterSection.classList.add("hide");
      stage.classList.remove("hide");
      letterSection.classList.remove("fade-in");

      envelope.classList.remove("opening");
      void envelope.offsetWidth; // reinicia animación
      openBtn.disabled = false;

      showToast("Listo.");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function updateReadProgress(){
      const el = text;
      const max = el.scrollHeight - el.clientHeight;
      const p = max <= 0 ? 1 : (el.scrollTop / max);
      const pct = Math.max(0, Math.min(1, p));

      readBar.style.width = Math.round(pct * 100) + "%";
      readLabel.textContent = "Leído " + Math.round(pct * 100) + "%";

      if(pct >= 0.94){
        closeBtn.classList.add("ready");
      }
    }

    /* Eventos */
    openBtn.addEventListener("click", () => {
      openBtn.disabled = true;
      envelope.classList.add("opening");

      playSealSnap();
      setTimeout(playRustle, 240);

      const onEnd = (e) => {
        if(e.animationName !== "paperPull") return;
        paper.removeEventListener("animationend", onEnd);
        openLetter();
      };
      paper.addEventListener("animationend", onEnd);
    });

    text.addEventListener("scroll", updateReadProgress);

    closeBtn.addEventListener("click", () => {
      if(!closeBtn.classList.contains("ready")) return;
      showToast("Guardado.");
      resetAll();
    });

    nightBtn.addEventListener("click", () => {
      noche = !noche;
      applyPrefs();
    });

    soundBtn.addEventListener("click", () => {
      sonido = !sonido;
      applyPrefs();
    });

    loadPrefs();
  </script>
</body>
</html>
